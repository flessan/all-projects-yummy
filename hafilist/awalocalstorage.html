<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AwaDompet - Keuangan Pribadi</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        [v-cloak] { display: none; }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #888; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #555; }
    </style>
</head>
<body class="bg-gradient-to-br from-emerald-700 to-teal-800 min-h-screen text-white">
    <div id="app" v-cloak>
        <!-- Login Screen -->
        <div v-if="!isLoggedIn" class="flex items-center justify-center min-h-screen p-4">
            <div class="glass-effect p-8 rounded-2xl shadow-2xl w-full max-w-md">
                <div class="text-center mb-8">
                    <i class="fas fa-wallet text-6xl text-amber-400 mb-4"></i>
                    <h1 class="text-3xl font-bold text-white">AwaDompet</h1>
                    <p class="text-emerald-100">Kelola keuangan pribadi dengan mudah</p>
                </div>
                <form @submit.prevent="login" class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-emerald-100">Username</label>
                        <input v-model="loginForm.username" type="text" required 
                               class="mt-1 w-full px-4 py-2 bg-white/20 border border-white/30 rounded-lg text-white placeholder-emerald-200 focus:outline-none focus:ring-2 focus:ring-amber-400"
                               placeholder="admin">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-emerald-100">Password</label>
                        <input v-model="loginForm.password" type="password" required 
                               class="mt-1 w-full px-4 py-2 bg-white/20 border border-white/30 rounded-lg text-white placeholder-emerald-200 focus:outline-none focus:ring-2 focus:ring-amber-400"
                               placeholder="password123">
                    </div>
                    <div v-if="loginError" class="p-3 bg-red-500/20 border border-red-400 rounded-lg text-red-100 text-sm">
                        {{ loginError }}
                    </div>
                    <button type="submit" class="w-full py-3 bg-amber-500 hover:bg-amber-600 text-white font-bold rounded-lg shadow-lg transition duration-300 transform hover:scale-105">
                        Masuk
                    </button>
                    <p class="text-xs text-center text-emerald-200">Default: admin / password123</p>
                </form>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div v-else class="container mx-auto p-4 md:p-6">
            <!-- Header -->
            <header class="glass-effect rounded-xl p-4 mb-6 flex justify-between items-center">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-wallet text-3xl text-amber-400"></i>
                    <h1 class="text-2xl md:text-3xl font-bold">AwaDompet</h1>
                </div>
                <div class="flex items-center space-x-2">
                    <button @click="resetApp" class="px-3 py-1 bg-red-500/20 hover:bg-red-500/30 border border-red-400 rounded-lg text-sm transition">
                        <i class="fas fa-trash-alt mr-1"></i> Reset
                    </button>
                    <button @click="logout" class="px-3 py-1 bg-white/20 hover:bg-white/30 border border-white/40 rounded-lg text-sm transition">
                        <i class="fas fa-sign-out-alt mr-1"></i> Logout
                    </button>
                </div>
            </header>

            <!-- Success Message -->
            <div v-if="successMessage" class="fixed top-4 right-4 bg-green-500 text-white p-4 rounded-lg shadow-xl z-50 animate-pulse">
                {{ successMessage }}
            </div>

            <!-- Summary Cards -->
            <section class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                <div class="bg-white/10 backdrop-blur-md rounded-xl p-6 border border-white/20">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-emerald-100 text-sm">Saldo Akhir</p>
                            <p class="text-2xl font-bold mt-1" :class="balance >= 0 ? 'text-white' : 'text-red-300'">
                                {{ formatCurrency(balance) }}
                            </p>
                        </div>
                        <i class="fas fa-piggy-bank text-3xl text-white/50"></i>
                    </div>
                </div>
                <div @click="openIncomeModal" class="bg-gradient-to-r from-green-500 to-emerald-600 rounded-xl p-6 shadow-lg cursor-pointer transform transition duration-300 hover:scale-105">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-green-100 text-sm">Total Pemasukan</p>
                            <p class="text-2xl font-bold mt-1 text-white">{{ formatCurrency(totalIncome) }}</p>
                        </div>
                        <i class="fas fa-arrow-down text-3xl text-white/50"></i>
                    </div>
                </div>
                <div @click="openExpenseModal" class="bg-gradient-to-r from-red-500 to-pink-600 rounded-xl p-6 shadow-lg cursor-pointer transform transition duration-300 hover:scale-105">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-red-100 text-sm">Total Pengeluaran</p>
                            <p class="text-2xl font-bold mt-1 text-white">{{ formatCurrency(totalExpense) }}</p>
                        </div>
                        <i class="fas fa-arrow-up text-3xl text-white/50"></i>
                    </div>
                </div>
            </section>

            <!-- Charts Section -->
            <section class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                <div class="bg-white rounded-xl p-6 shadow-xl">
                    <h2 class="text-lg font-bold text-gray-700 mb-4">Distribusi Pengeluaran per Kategori</h2>
                    <canvas id="pieChart" class="max-h-64"></canvas>
                </div>
                <div class="bg-white rounded-xl p-6 shadow-xl">
                    <h2 class="text-lg font-bold text-gray-700 mb-4">Rasio Kebutuhan vs Keinginan</h2>
                    <canvas id="doughnutChart" class="max-h-64"></canvas>
                </div>
            </section>

            <!-- Transaction History -->
            <section class="bg-white rounded-xl p-6 shadow-xl">
                <h2 class="text-xl font-bold text-gray-700 mb-4">Riwayat Transaksi</h2>
                <div v-if="transactions.length === 0" class="text-center py-8 text-gray-500">
                    <i class="fas fa-inbox text-4xl mb-2"></i>
                    <p>Belum ada transaksi.</p>
                </div>
                <div v-else class="overflow-x-auto custom-scrollbar">
                    <table class="min-w-full">
                        <thead class="bg-gray-100">
                            <tr>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tanggal</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Tipe</th>
                                <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase">Kategori</th>
                                <th class="px-4 py-3 text-right text-xs font-medium text-gray-500 uppercase">Jumlah</th>
                                <th class="px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase">Aksi</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y divide-gray-200">
                            <tr v-for="transaction in sortedTransactions" :key="transaction.id" class="hover:bg-gray-50">
                                <td class="px-4 py-3 text-sm text-gray-700">{{ transaction.date }}</td>
                                <td class="px-4 py-3">
                                    <span :class="transaction.type === 'income' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'" 
                                          class="px-2 py-1 inline-flex text-xs leading-5 font-semibold rounded-full">
                                        {{ transaction.type === 'income' ? 'Pemasukan' : 'Pengeluaran' }}
                                    </span>
                                </td>
                                <td class="px-4 py-3 text-sm text-gray-700">{{ transaction.category }}</td>
                                <td class="px-4 py-3 text-sm font-semibold text-right" :class="transaction.type === 'income' ? 'text-green-600' : 'text-red-600'">
                                    {{ formatCurrency(transaction.amount) }}
                                </td>
                                <td class="px-4 py-3 text-sm text-center">
                                    <button @click="deleteTransaction(transaction.id)" class="text-red-500 hover:text-red-700">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>

        <!-- Income Modal -->
        <div v-if="showIncomeModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="bg-white rounded-xl p-6 w-full max-w-md">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Tambah Pemasukan</h3>
                <form @submit.prevent="addIncome">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Tanggal</label>
                        <input v-model="incomeForm.date" type="date" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Kategori</label>
                        <div v-if="!incomeForm.isCustom">
                            <select v-model="incomeForm.category" @change="handleCategoryChange('income')" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                                <option v-for="cat in defaultIncomeCategories" :key="cat" :value="cat">{{ cat }}</option>
                                <option value="Lainnya">Lainnya (Isi Sendiri)</option>
                            </select>
                        </div>
                        <div v-else>
                            <input v-model="incomeForm.category" type="text" required placeholder="Masukkan kategori baru" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                            <button type="button" @click="incomeForm.isCustom = false; incomeForm.category = defaultIncomeCategories[0]" class="text-xs text-blue-500 hover:underline mt-1">← Kembali ke pilihan</button>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Jumlah (Rp)</label>
                        <input v-model="incomeForm.amount" type="number" required min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500">
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" @click="closeIncomeModal" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">Batal</button>
                        <button type="submit" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600">Simpan</button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Expense Modal -->
        <div v-if="showExpenseModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50">
            <div class="bg-white rounded-xl p-6 w-full max-w-md">
                <h3 class="text-xl font-bold text-gray-800 mb-4">Tambah Pengeluaran</h3>
                <form @submit.prevent="addExpense">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Tanggal</label>
                        <input v-model="expenseForm.date" type="date" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Kategori</label>
                        <div v-if="!expenseForm.isCustom">
                            <select v-model="expenseForm.category" @change="handleCategoryChange('expense')" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                                <option v-for="cat in defaultExpenseCategories" :key="cat" :value="cat">{{ cat }}</option>
                                <option value="Lainnya">Lainnya (Isi Sendiri)</option>
                            </select>
                        </div>
                        <div v-else>
                            <input v-model="expenseForm.category" type="text" required placeholder="Masukkan kategori baru" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                            <button type="button" @click="expenseForm.isCustom = false; expenseForm.category = defaultExpenseCategories[0]" class="text-xs text-blue-500 hover:underline mt-1">← Kembali ke pilihan</button>
                        </div>
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2">Jumlah (Rp)</label>
                        <input v-model="expenseForm.amount" type="number" required min="1" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500">
                    </div>
                    <div class="flex justify-end space-x-2">
                        <button type="button" @click="closeExpenseModal" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">Batal</button>
                        <button type="submit" class="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">Simpan</button>
                    </div>
                </form>
            </div>
        </div>

    </div>

    <script>
        const { createApp, ref, reactive, computed, onMounted, watch } = Vue;

        createApp({
            setup() {
                // --- State ---
                const isLoggedIn = ref(false);
                const loginForm = reactive({ username: '', password: '' });
                const loginError = ref('');
                const successMessage = ref('');
                
                const showIncomeModal = ref(false);
                const showExpenseModal = ref(false);
                
                const transactions = ref([]);
                
                const incomeForm = reactive({
                    date: new Date().toISOString().split('T')[0],
                    category: 'Gaji',
                    amount: null,
                    isCustom: false
                });

                const expenseForm = reactive({
                    date: new Date().toISOString().split('T')[0],
                    category: 'Makanan',
                    amount: null,
                    isCustom: false
                });

                const defaultIncomeCategories = ['Gaji', 'Bonus', 'Investasi', 'Freelance', 'Hadiah'];
                const defaultExpenseCategories = ['Makanan', 'Transportasi', 'Tagihan', 'Belanja', 'Hiburan', 'Kesehatan'];
                const needsCategories = ['Makanan', 'Transportasi', 'Tagihan', 'Kesehatan'];
                
                let pieChartInstance = null;
                let doughnutChartInstance = null;

                // --- Computed Properties ---
                const totalIncome = computed(() => 
                    transactions.value.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0)
                );

                const totalExpense = computed(() => 
                    transactions.value.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0)
                );
                
                const balance = computed(() => totalIncome.value - totalExpense.value);

                const sortedTransactions = computed(() => 
                    [...transactions.value].sort((a, b) => new Date(b.date) - new Date(a.date))
                );

                // --- Methods ---
                const formatCurrency = (amount) => {
                    return new Intl.NumberFormat('id-ID', { style: 'currency', currency: 'IDR', minimumFractionDigits: 0 }).format(amount);
                };

                const loadData = () => {
                    const savedData = localStorage.getItem('awadompet_data');
                    if (savedData) {
                        transactions.value = JSON.parse(savedData);
                    }
                };

                const saveData = () => {
                    localStorage.setItem('awadompet_data', JSON.stringify(transactions.value));
                };

                const login = () => {
                    if (loginForm.username === 'admin' && loginForm.password === 'password123') {
                        isLoggedIn.value = true;
                        localStorage.setItem('awadompet_loggedIn', 'true');
                        loadData();
                        updateCharts();
                    } else {
                        loginError.value = 'Username atau password salah!';
                    }
                };

                const logout = () => {
                    isLoggedIn.value = false;
                    localStorage.removeItem('awadompet_loggedIn');
                    loginForm.username = '';
                    loginForm.password = '';
                };

                const resetApp = () => {
                    if (confirm('Apakah Anda yakin ingin mereset semua data?')) {
                        localStorage.removeItem('awadompet_data');
                        transactions.value = [];
                        updateCharts();
                        showSuccessMessage('Data berhasil direset!');
                    }
                };
                
                const showSuccessMessage = (msg) => {
                    successMessage.value = msg;
                    setTimeout(() => successMessage.value = '', 3000);
                };

                const openIncomeModal = () => {
                    incomeForm.date = new Date().toISOString().split('T')[0];
                    incomeForm.category = defaultIncomeCategories[0];
                    incomeForm.amount = null;
                    incomeForm.isCustom = false;
                    showIncomeModal.value = true;
                };

                const closeIncomeModal = () => {
                    showIncomeModal.value = false;
                };

                const openExpenseModal = () => {
                    expenseForm.date = new Date().toISOString().split('T')[0];
                    expenseForm.category = defaultExpenseCategories[0];
                    expenseForm.amount = null;
                    expenseForm.isCustom = false;
                    showExpenseModal.value = true;
                };

                const closeExpenseModal = () => {
                    showExpenseModal.value = false;
                };
                
                const handleCategoryChange = (type) => {
                    if (type === 'income') {
                        if (incomeForm.category === 'Lainnya') {
                            incomeForm.isCustom = true;
                            incomeForm.category = '';
                        }
                    } else {
                        if (expenseForm.category === 'Lainnya') {
                            expenseForm.isCustom = true;
                            expenseForm.category = '';
                        }
                    }
                };

                const addIncome = () => {
                    const newTransaction = {
                        id: Date.now(),
                        type: 'income',
                        category: incomeForm.category,
                        amount: parseInt(incomeForm.amount),
                        date: incomeForm.date
                    };
                    transactions.value.push(newTransaction);
                    saveData();
                    updateCharts();
                    closeIncomeModal();
                    showSuccessMessage('Pemasukan berhasil ditambahkan!');
                };

                const addExpense = () => {
                    const newTransaction = {
                        id: Date.now(),
                        type: 'expense',
                        category: expenseForm.category,
                        amount: parseInt(expenseForm.amount),
                        date: expenseForm.date
                    };
                    transactions.value.push(newTransaction);
                    saveData();
                    updateCharts();
                    closeExpenseModal();
                    showSuccessMessage('Pengeluaran berhasil ditambahkan!');
                };

                const deleteTransaction = (id) => {
                    if (confirm('Hapus transaksi ini?')) {
                        transactions.value = transactions.value.filter(t => t.id !== id);
                        saveData();
                        updateCharts();
                        showSuccessMessage('Transaksi berhasil dihapus!');
                    }
                };

                // --- Chart Methods ---
                const updateCharts = () => {
                    updatePieChart();
                    updateDoughnutChart();
                };

                const updatePieChart = () => {
                    const ctx = document.getElementById('pieChart');
                    if (!ctx) return;

                    const expenseData = transactions.value
                        .filter(t => t.type === 'expense')
                        .reduce((acc, t) => {
                            acc[t.category] = (acc[t.category] || 0) + t.amount;
                            return acc;
                        }, {});
                    
                    if (pieChartInstance) pieChartInstance.destroy();

                    pieChartInstance = new Chart(ctx, {
                        type: 'pie',
                        data: {
                            labels: Object.keys(expenseData),
                            datasets: [{
                                data: Object.values(expenseData),
                                backgroundColor: ['#FF6384', '#36A2EB', '#FFCE56', '#4BC0C0', '#9966FF', '#FF9F40']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom' },
                                tooltip: {
                                    callbacks: {
                                        label: (context) => `${context.label}: ${formatCurrency(context.raw)}`
                                    }
                                }
                            }
                        }
                    });
                };

                const updateDoughnutChart = () => {
                    const ctx = document.getElementById('doughnutChart');
                    if (!ctx) return;
                    
                    let totalNeeds = 0;
                    let totalWants = 0;

                    transactions.value.filter(t => t.type === 'expense').forEach(t => {
                        if (needsCategories.includes(t.category)) {
                            totalNeeds += t.amount;
                        } else {
                            totalWants += t.amount;
                        }
                    });

                    if (doughnutChartInstance) doughnutChartInstance.destroy();

                    doughnutChartInstance = new Chart(ctx, {
                        type: 'doughnut',
                        data: {
                            labels: ['Kebutuhan', 'Keinginan'],
                            datasets: [{
                                data: [totalNeeds, totalWants],
                                backgroundColor: ['#10b981', '#ef4444']
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                legend: { position: 'bottom' },
                                tooltip: {
                                    callbacks: {
                                        label: (context) => `${context.label}: ${formatCurrency(context.raw)}`
                                    }
                                }
                            }
                        }
                    });
                };

                // --- Lifecycle ---
                onMounted(() => {
                    const loggedInStatus = localStorage.getItem('awadompet_loggedIn');
                    if (loggedInStatus === 'true') {
                        isLoggedIn.value = true;
                        loadData();
                        // Defer chart update to next tick to ensure DOM is ready
                        Vue.nextTick(() => {
                           updateCharts();
                        });
                    }
                });

                // --- Watchers ---
                watch(isLoggedIn, (newStatus) => {
                    if (newStatus) {
                        Vue.nextTick(() => {
                           updateCharts();
                        });
                    }
                });

                return {
                    // State
                    isLoggedIn, loginForm, loginError, successMessage,
                    showIncomeModal, showExpenseModal, transactions,
                    incomeForm, expenseForm,
                    defaultIncomeCategories, defaultExpenseCategories,
                    
                    // Computed
                    totalIncome, totalExpense, balance, sortedTransactions,

                    // Methods
                    formatCurrency, login, logout, resetApp,
                    openIncomeModal, closeIncomeModal, openExpenseModal, closeExpenseModal,
                    handleCategoryChange, addIncome, addExpense, deleteTransaction
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
